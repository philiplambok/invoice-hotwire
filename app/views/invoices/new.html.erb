<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <h5>Create a new invoice</h5>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <%= form_with(model: @invoice, data: { controller: 'invoices' }) do |form| %>
        <div class="form-group">
          <%= form.label :number, class: 'form-label' %>
          <%= form.text_field :number, placeholder: 'Invoice Number', class: 'form-control', required: true %>
        </div>
        <div class="form-group mt-2 row">
          <div class="col-md-6">
            <%= form.label :customer, class: 'form-label' %>
            <%= form.select :customer, 
                Customer.all.pluck(:name, :email), 
                { prompt: 'Select Customer' }, 
                { required: true, class: 'form-control', data: { action: 'change->invoices#updateEmail' } } %>
          </div>
          <div class="col-md-6">
            <%= form.label :email, class: 'form-label' %>
            <%= form.text_field :email, class: 'form-control', disabled: true, class: 'form-control', data: { 'invoices-target': 'emailField' }  %>
          </div>
        </div>

        <span class="fw-bold d-block my-4">Products</span>

        <%= fields_for :invoice_products do |product_form| %>
          <div class="form-group row" data-controller="invoice-products">
            <div class="col-md-4">
              <%= product_form.label :product_name, class: 'form-label' %>
              <%= product_form.select :product_id, options_for_select(products_options), { prompt: 'Select product' }, class: 'form-control'  %>
            </div>
            <div class="col-md-2">
              <%= product_form.label :unit, class: 'form-label' %>
              <%= product_form.number_field :unit, class: 'form-control', data: { action: 'change->invoice-products#updateProductItemPrice' } %>
            </div>
            <div class="col-md-2">
              <%= product_form.label :price_per_unit, class: 'form-label' %>
              <%= product_form.text_field :price_per_unit, class: 'form-control', disabled: true, data: { target: 'invoice-products#pricePerUnit' } %>
            </div>
            <div class="col-md-4">
              <%= product_form.label :total, class: 'form-label' %>
              <%= product_form.text_field :total, class: 'form-control', disabled: true, data: { target: 'invoice-products#total' } %>
            </div>
          </div>
        <% end %>
        <br>
        <%= form.submit 'Submit', class: 'btn btn-primary px-4' %>
      <% end %>
    </div>
  </div>
</div>